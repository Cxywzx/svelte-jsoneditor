import dts from 'rollup-plugin-dts'

export default {
  input: 'package/index-vanilla.d.ts',
  output: [
    {
      file: 'package-vanilla/index.d.ts',
      format: 'es'
    },
    {
      file: 'package-vanilla/standalone.d.ts',
      format: 'es'
    }
  ],
  plugins: [dts(), exportJsonEditorClass()]
}

// The DTS plugin doesn't export the JsonEditor class that is generated by Svelte whilst compiling,
// so we append an export for it manually. Similarly, the CreateJSONEditorProps interface is not
// exported by DTS, so we add an export for it too.
function exportJsonEditorClass() {
  return {
    name: 'export-json-editor',
    transform: (code, id) => {
      if (id.endsWith('index-vanilla.d.ts')) {
        const customExports = 'export type { JsonEditor, CreateJSONEditorProps }'

        return `${code}\n${customExports}\n`
      }

      return code
    }
  }
}
